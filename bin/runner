#!/usr/bin/env php
<?php

use Symfony\Component\ErrorHandler\Debug;
use Symfony\Component\Console\Logger\ConsoleLogger;
use Symfony\Component\Console\Output\ConsoleOutput;
use Symfony\Component\Console\Output\OutputInterface;

require_once __DIR__.'/../vendor/autoload.php';

Debug::enable();

if ($argc !== 2) {
    echo "USAGE: ".$argv[0]." FILE\n";
    exit(1);
}

$file = $argv[1];
if (!file_exists($file)) {
    echo 'File "'.$file.'" not found.\n';
    exit(1);
}

$verbosity = OutputInterface::VERBOSITY_DEBUG;
$logger = new ConsoleLogger(new ConsoleOutput($verbosity));
$session = new FunctionalPhp\Session(logger: $logger);

$counterA = 0;

require $file;

$mem = memory_get_peak_usage();
$time = microtime(true);
$session->run();
$time = microtime(true) - $time;
$mem = memory_get_peak_usage() - $mem;

echo sprintf("Time     : %.6fs\n", $time);
echo sprintf("Memory   : %.2fMB\n", $mem / 1024 / 1024);
echo sprintf("Counter A: %d\n", $counterA);
